<!DOCTYPE html>
<html>
    <style>

        header {
          width:300px;
          float:left;
          background: cyan;
          height: 20px;
          text-indent: 0cm;
        }
        
        .first-box {
          width:300px;
          float:left;
          background: cyan;
          height: 200px;
          margin: 10px
        }
        
        .first-box p {
          color: #ffffff;xe
          padding-left: 80px;
          padding-top: 50px;
        }
        </style>


<!-- ////////////////////////////////////////////////
//                                            // 
//////////////// VERTEX SHADER /////////////////   
//                                            // 
//////////////////////////////////////////////// -->
<script id="vertex-shader" type="x-shader/x-vertex">
#version 300 es

in  vec4 aPosition;
in  vec4 aColor;
in  vec4 vNormal;
in vec2 vTexCoord;
out vec2 fTexCoord;
out vec4 vColor;

// Light
out vec3 N, L, E;
out float distance_light;

// Light -- directional
out vec3 dir_N,dir_L,dir_E;

//Light -- spotlight
out vec3 spot_N,spot_L,spot_E;

uniform vec3 uTheta;

uniform mat4 uModelViewMatrix;
uniform mat4 uProjectionMatrix;

uniform vec4 uLightPosition;
uniform float uShininess;

uniform vec4 uLightPositionDirectional;
uniform vec4 uSpotlightDirection;
uniform float uConstantAttenuation; 

out float attenuation;

void main()
{   ////////////////////////////////////////////////
    // ROTATION PART
    ////////////////////////////////////////////////
    vec3 angles = radians(uTheta);
    vec3 c = cos(angles);
    vec3 s = sin(angles);
    // Remeber: thse matrices are column-major
    mat4 rx = mat4(1.0, 0.0, 0.0, 0.0,
        0.0, c.x, s.x, 0.0,
        0.0, -s.x, c.x, 0.0,
        0.0, 0.0, 0.0, 1.0 );
    mat4 ry = mat4(c.y, 0.0, -s.y, 0.0,
        0.0, 1.0, 0.0, 0.0,
        s.y, 0.0, c.y, 0.0,
        0.0, 0.0, 0.0, 1.0);
    mat4 rz = mat4(c.z, s.z, 0.0, 0.0,
        -s.z, c.z, 0.0, 0.0,
        0.0,  0.0, 1.0, 0.0,
        0.0,  0.0, 0.0, 1.0);

    ////////////////////////////////////////////////
    // LIGHT PART
    ////////////////////////////////////////////////
    vec3 pos=-(uModelViewMatrix*(rz * ry * rx * aPosition)).xyz;

    vec3 light=uLightPosition.xyz;
     if(uLightPosition.w == 0.0){
        L = normalize(light.xyz);
      }
     else{
        L = normalize(light.xyz/uLightPosition.w - pos);
        N = normalize((uModelViewMatrix*vNormal).xyz);
        E = normalize( -pos );
      }
   
    // directional light
    vec3 directionlight =  uLightPositionDirectional.xyz;
      if (uLightPositionDirectional.w == 0.0){
        dir_L = normalize(directionlight);
      }
      else{
        dir_L = normalize(directionlight - pos);
      }
      dir_E = -normalize(pos);
   
    // Spotlight
    vec3 spotlight  = uSpotlightDirection.xyz;
    spot_L = normalize(spotlight*vNormal.xyz);
    spot_E  = normalize(spotlight - pos);
   
   
    // attentuation factor 
    // calculate the distance to the light source 
   
    distance_light = sqrt(pow(L.x,2.0)+pow(L.y,2.0)+pow(L.z,2.0));
    attenuation = 1.0/(uConstantAttenuation*distance_light+ 1.0);
    
      
    gl_Position = uProjectionMatrix*uModelViewMatrix*(rz * ry * rx * aPosition);
    gl_Position.z = -gl_Position.z;

    fTexCoord = vTexCoord;


}
</script>


<!-- ////////////////////////////////////////////////
//                                            // 
//////////////// FRAGMENT SHADER ///////////////   
//                                            // 
//////////////////////////////////////////////// -->
<script id="fragment-shader" type="x-shader/x-fragment">

#version 300 es

precision mediump float;

in vec4 vColor;
in vec2 fTexCoord;

// Light
in vec3 N, L, E;

// distance 
in float distance_light;

// attenuation 
in float attenuation;

// Directional
in vec3 dir_N,dir_L,dir_E;

// Spotlight
in vec3 spot_N,spot_L,spot_E;

// light 
uniform vec4 uAmbientProduct, uDiffuseProduct,  uSpecularProduct;

// directional light
uniform vec4 uAmbientProductDirectional, uDiffuseProductDirectional;

// spotlight
uniform vec4 uAmbientProductSpotlight, uDiffuseProductSpotlight;
uniform vec4 uMaterialDiffuse;
uniform vec4 uMaterialAmbient;

// direction for spot light 
uniform float shininess;
uniform float spotLightCuttOff;
uniform float spotLightAngle;

// shader
uniform vec4 ag;

out vec4 fColor;
uniform sampler2D texture_test;
uniform float texturetoggle;





float spotLightCalculation(){
  float spot_factor ;
 float spot_cosine =  dot(spot_E , -L);
  if (spot_cosine > cos(radians(spotLightAngle))){
      // assigning value to spot factor 
      spot_factor = pow(spot_cosine,spotLightCuttOff);
      spot_factor = spot_factor * (1.0 - (1.0-spot_cosine)*attenuation*1.0);
  }else{
      // point outside cone of light  
          spot_factor = 0.0; // light will be no color 
      }
  return spot_factor;
    }
void
main()
{
   // fColor = vColor;
   // step first is to calculate the c_i and c_s 
   // c_i = a(g) * am +a(l) * am + d(l) * dm

   // where am  is nothing but ambient , dm is diffuse coffecient of material 
   vec4 ambient_  =  uAmbientProduct;
   vec4 diffuse_  = uDiffuseProduct;

   vec4 direction_ambient = uAmbientProduct;
   vec4 direction_diffuse = uDiffuseProductDirectional;

   // finding the spot factor 
  
   float spot_factor = spotLightCalculation();


   // checking 
   vec4 ci_color;
   if (max(dot(L,N),0.0)>=0.5){
       ci_color = (ag*uMaterialAmbient + ambient_*uMaterialAmbient + diffuse_*uMaterialDiffuse) ;
   }else{
       ci_color = (ag*uMaterialAmbient + ambient_*uMaterialAmbient)*spot_factor;
   }


   vec4 cs_color;

   if (max(dot(dir_L,N),0.0)>=0.5){
       cs_color = (ag*uMaterialAmbient + direction_ambient*uMaterialAmbient + direction_diffuse*uMaterialDiffuse);
   }else{
       cs_color  = (ag*uMaterialAmbient + direction_ambient*uMaterialAmbient)*spot_factor;
   }
    
    
    if(texturetoggle == 0.0){
      fColor = cs_color+ci_color; // vColor ;
      }else{
          fColor = (cs_color+ci_color) * texture( texture_test, fTexCoord );
      }
      fColor.a = 1.0;
  
}
</script>



<script type="text/javascript" src="../Common/initShaders.js"></script>
<script type="text/javascript" src="../Common/MVnew.js"></script>
<script type="text/javascript" src="homework1.js"></script>

<!-- ////////////////////////////////////////////////
//                                            // 
//////////////////// SLIDERS  //////////////////   
//                                            // 
//////////////////////////////////////////////// -->
<body>
<canvas id="gl-canvas" width="512" height="512">
Oops ... your browser doesn't support the HTML5 canvas element
</canvas>
<img id = "texImage" src = "https://i.imgur.com/vA23abOr.jpg" crossorigin="anonymous" hidden></img>

<div class="container">
    <div class="first-box">
    <div>
    zNear .01<input id="zNearSlider" type="range"
     min=".01" max="3" step="0.1" value="0.3" />
     3
    </div>
    <div>
      radius 0.05<input id="radiusSlider" type="range"
       min="0.05" max="10" step="0.1" value="4" />
       10
      </div>
      <div>
      theta -90<input id="thetaSlider" type="range"
       min="-90" max="90" step="5" value="0" />
       90
      </div>
      <div>
      phi -90<input id="phiSlider" type="range"
       min="-90" max="90" step="5" value="0" />
       90
      </div>
      <div>
        Scale 
        <input id="scaleSlider" type="range"
        min="0.01" max="2" step="0.01" value ="1" />
        
        </div>
    <div>
    zFar 0<input id="zFarSlider" type="range"
     min="3" max="10" step="3.0" value="10" />
     10
    </div>
  </div>

    <div class="container">
      <div class="first-box">
    <div>
    x -5<input id="xSlider" type="range"
     min="-20" max="20" step="0.1" value="0" />
     5
    </div>
    <div>
    y -5<input id="ySlider" type="range"
     min="-20" max="20" step="0.1" value="0" />
     5
    </div>
    <div>
    z 0<input id="zSlider" type="range"
     min="-20" max="20" step="0.1" value="4" />
     10
    </div>
    <div>
    fov 10<input id="fovSlider" type="range"
     min="10" max="120" step="5" value="45" />
     120
    </div>
    <div>
    aspect 0.5<input id="aspectSlider" type="range"
     min="0.5" max="2" step="0.1" value="2" />
     2
     <div>
      <button id = "Button6">Increase speed</button>
      <button id = "Button7">Decrease speed</button>
      </div>
    </div>
    
      <button id = "ButtonX">Rotate X</button>
      <button id = "ButtonY">Rotate Y</button>
      <button id = "ButtonZ">Rotate Z</button>
      <button id = "ButtonT">Toggle Rotation</button>
      
    </div>
  </div>

  <div class="container">
    <div class="first-box">
      
      <div>
      Click to reset all values
      <input type="button" value="RESET" onclick="resetButton()">
      </div>

      <div>
      Light X Translation 
      0<input id="xLight" type="range"
      min="0" max="1" step="0.1" value ="1.0" />1
      </div>

      <div>
      Light Y Translation 
      0<input id="yLight" type="range"
      min="0" max="1" step="0.1" value ="1.0" />1
      </div>
      
      <div>
      Light Z Translation 
      0<input id="zLight" type="range"
      min="0" max="1" step="0.1" value ="1.0" />1
      </div>

 
    <div>
    <button id="texture_switch" >Toggle Texture</button>
    </div>
    
    <div>
      Spotlight: cutt off
      1<input id="spotLightCuttOff" type="range"
      min="0" max="80" step="10" value ="10.0" />80
    </div>

    <div>
      Spotlight: angle
      0<input id="spotAngle" type="range"
      min="10" max="100" step="0.1" value ="10.0" />100
    </div>
  </div>
    
 

</body>
</html>

